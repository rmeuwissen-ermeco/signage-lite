<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Signage Lite Admin – Players</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background: #111;
      color: #f5f5f5;
      font-family: system-ui;
    }
    header {
      background: #222;
      padding: 10px 16px;
      border-bottom: 1px solid #333;
      display: flex;
      gap: 12px;
      align-items: center;
    }
    main {
      padding: 16px;
      max-width: 900px;
      margin: 0 auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #333;
    }
    button {
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #555;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
    }
    button.danger {
      border-color: #a33;
      color: #fbb;
    }
    input {
      background: #111;
      color: #fff;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 4px 8px;
    }
  </style>
</head>
<body>

<header>
  <a href="/admin-tenants.html" style="color:#9cf; text-decoration:none;">← Tenants</a>
  <select id="tenant-select"></select>
  <button id="reload-btn">Players laden</button>
</header>

<main>
  <div id="status">Kies een tenant.</div>

  <form id="player-form" style="margin-top:20px; display:flex; gap:8px;">
    <input id="player-name" placeholder="Player naam" required />
    <input id="player-location" placeholder="Locatie (optioneel)" />
    <button type="submit">Toevoegen</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Naam</th>
        <th>Locatie</th>
        <th>Device</th>
        <th>Acties</th>
      </tr>
    </thead>
    <tbody id="player-tbody"></tbody>
  </table>
</main>

<script>
  const tenantSelect = document.getElementById("tenant-select");
  const statusEl = document.getElementById("status");
  const tbodyEl = document.getElementById("player-tbody");
  const reloadBtn = document.getElementById("reload-btn");
  const form = document.getElementById("player-form");

  async function loadTenants() {
    const res = await fetch("/api/admin/tenants");
    const tenants = await res.json();
    tenantSelect.innerHTML = "";
    tenants.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t.id;
      opt.textContent = `${t.id} – ${t.name}`;
      tenantSelect.appendChild(opt);
    });
    if (tenants.length) loadPlayers();
  }

  async function loadPlayers() {
    const tenantId = tenantSelect.value;
    if (!tenantId) return;

    statusEl.textContent = "Players laden…";

    const res = await fetch(`/api/admin/tenants/${tenantId}/players`);
    const players = await res.json();

    tbodyEl.innerHTML = "";

    players.forEach(p => {
      const tr = document.createElement("tr");

      const deviceInfo = p.device ? p.device.deviceName : "–";

      tr.innerHTML = `
        <td>${p.id}</td>
        <td>${p.name}</td>
        <td>${p.location || "–"}</td>
        <td>${deviceInfo}</td>
        <td><button class="danger" data-id="${p.id}">Delete</button></td>
      `;

      const delBtn = tr.querySelector("button");
      delBtn.addEventListener("click", async () => {
        if (!confirm(`Player "${p.name}" (#${p.id}) verwijderen?`)) return;
        await fetch(`/api/admin/players/${p.id}`, { method: "DELETE" });
        loadPlayers();
      });

      tbodyEl.appendChild(tr);
    });

    statusEl.textContent = `${players.length} player(s) geladen.`;
  }

  form.addEventListener("submit", async (ev) => {
    ev.preventDefault();
    const tenantId = tenantSelect.value;
    const name = document.getElementById("player-name").value;
    const location = document.getElementById("player-location").value;

    await fetch(`/api/admin/tenants/${tenantId}/players`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, location }),
    });

    document.getElementById("player-name").value = "";
    document.getElementById("player-location").value = "";
    loadPlayers();
  });

  reloadBtn.addEventListener("click", loadPlayers);
  tenantSelect.addEventListener("change", loadPlayers);

  window.onload = loadTenants;
</script>

</body>
</html>

