<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Signage Lite – Media</title>
  <style>
    :root {
      --bg: #0b0b0b;
      --bg-elevated: #181818;
      --border-subtle: #303030;
      --accent: #4cafef;
      --accent-soft: rgba(76, 175, 239, 0.15);
      --text-main: #f5f5f5;
      --text-muted: #9a9a9a;
      --danger: #e57373;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    header {
      background: #111;
      border-bottom: 1px solid var(--border-subtle);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-title {
      font-size: 18px;
      font-weight: 600;
    }

    .brand-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    nav {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    nav a {
      text-decoration: none;
      font-size: 13px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
      color: var(--text-muted);
      background: transparent;
    }

    nav a:hover {
      border-color: var(--border-subtle);
      color: var(--text-main);
      background: #151515;
    }

    nav a.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
    }

    main {
      padding: 20px;
      max-width: 1100px;
      margin: 0 auto;
      width: 100%;
    }

    h1 {
      margin: 0 0 4px 0;
      font-size: 22px;
    }

    p.lead {
      margin: 0 0 16px 0;
      color: var(--text-muted);
      font-size: 13px;
    }

    h2 {
      margin-top: 24px;
      margin-bottom: 6px;
      font-size: 16px;
    }

    label {
      font-size: 13px;
      margin-right: 4px;
    }

    input, select {
      background: #111;
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 13px;
    }

    button {
      background: #1d1d1d;
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      padding: 4px 10px;
      font-size: 13px;
      cursor: pointer;
    }

    button:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    button.danger {
      border-color: var(--danger);
      color: #ffcdd2;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 13px;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid var(--border-subtle);
      text-align: left;
      vertical-align: middle;
    }

    th {
      color: var(--text-muted);
      font-weight: 500;
    }

    td.url-cell {
      max-width: 340px;
      word-break: break-all;
    }

    /* Thumbnail kolom in tabel */
    .thumb-col {
      width: 90px;
    }

    .thumb-wrapper {
      width: 80px;
      height: 45px;
      background: #111;
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .thumb-wrapper img {
      max-width: 100%;
      max-height: 100%;
      display: block;
    }

    /* Drag & drop upload */
    .upload-section {
      margin-top: 16px;
      padding: 12px;
      border-radius: 6px;
      background: #121212;
      border: 1px solid var(--border-subtle);
    }

    .upload-section h3 {
      margin: 0 0 6px 0;
      font-size: 14px;
    }

    .upload-section p {
      margin: 0 0 10px 0;
      font-size: 12px;
      color: var(--text-muted);
    }

    .dropzone {
      margin-top: 8px;
      border: 1px dashed var(--border-subtle);
      border-radius: 6px;
      padding: 18px;
      text-align: center;
      cursor: pointer;
      background: #111;
      transition: border-color 0.15s ease, background 0.15s ease;
      font-size: 13px;
      color: var(--text-muted);
    }

    .dropzone strong {
      color: var(--text-main);
    }

    .dropzone.dragover {
      border-color: var(--accent);
      background: #141b22;
      color: var(--text-main);
    }

    .dropzone small {
      display: block;
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    footer {
      margin-top: auto;
      padding: 10px 20px;
      font-size: 11px;
      color: var(--text-muted);
      border-top: 1px solid var(--border-subtle);
      background: #0f0f0f;
    }
  </style>
</head>
<body>

<header>
  <div class="brand">
    <div class="brand-title">Signage Lite – Admin</div>
    <div class="brand-subtitle">Media beheer</div>
  </div>
  <nav>
    <a href="/admin.html">Overzicht</a>
    <a href="/admin-tenants.html">Tenants</a>
    <a href="/admin-players.html">Players</a>
    <a href="/admin-media.html" class="active">Media</a>
    <a href="/admin-playlists.html">Playlists</a>
  </nav>
</header>

<main>
  <h1>Media</h1>
  <p class="lead">
    Media is gekoppeld aan een tenant en wordt gebruikt in playlists.
    Je kunt bestanden uploaden of een externe URL koppelen.
  </p>

  <h2>1. Tenant & nieuwe media</h2>

  <div style="margin-bottom:12px;">
    <label for="tenantSelect">Tenant:</label>
    <select id="tenantSelect"></select>
  </div>

  <!-- 1A. Upload via drag & drop / klik -->
  <div class="upload-section">
    <h3>Upload bestand</h3>
    <p>
      Sleep een afbeelding of video in het vak hieronder, of klik om een bestand te kiezen.
    </p>

    <div
      id="dropZone"
      class="dropzone"
    >
      <strong>Sleep een bestand hierheen</strong><br>
      of klik om een bestand te selecteren
      <small>Ondersteund: afbeeldingen en video’s</small>
    </div>

    <!-- Verborgen file input; wordt gebruikt door klik & drop -->
    <input
      type="file"
      id="uploadFile"
      accept="image/*,video/*"
      multiple
      style="display:none;"
    />
  </div>

  <!-- 1B. Handmatige URL -->
  <h2>2. Media via URL toevoegen</h2>

  <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:flex-end;">
    <div>
      <label for="filename">Bestandsnaam</label><br>
      <input type="text" id="filename" placeholder="bijv. promo-beeld.jpg" />
    </div>
    <div style="min-width:260px;">
      <label for="url">URL</label><br>
      <input type="text" id="url" placeholder="https://…" style="min-width:260px;" />
    </div>
    <div>
      <label for="mimeType">MIME-type</label><br>
      <input type="text" id="mimeType" placeholder="image/jpeg" />
    </div>
    <div>
      <label for="mediaType">Type</label><br>
      <select id="mediaType">
        <option value="IMAGE">IMAGE</option>
        <option value="VIDEO">VIDEO</option>
      </select>
    </div>
    <div>
      <button onclick="createMedia()">Toevoegen</button>
    </div>
  </div>

  <h2>3. Bestaande media</h2>

  <table id="mediaTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Preview</th>
        <th>Bestandsnaam</th>
        <th>Type</th>
        <th>MIME</th>
        <th>URL</th>
        <th>Acties</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<footer>
  Signage Lite – mediabeheer
</footer>

<script>
async function loadTenants() {
  const res = await fetch("/api/admin/tenants");
  const tenants = await res.json();

  const select = document.getElementById("tenantSelect");
  select.innerHTML = "";

  tenants.forEach((t) => {
    const opt = document.createElement("option");
    opt.value = t.id;
    opt.textContent = t.name;
    select.appendChild(opt);
  });

  select.onchange = loadMedia;
  loadMedia();
}

async function loadMedia() {
  const tenantId = document.getElementById("tenantSelect").value;
  if (!tenantId) return;

  const res = await fetch(`/api/admin/tenants/${tenantId}/media`);
  const media = await res.json();

  const tbody = document.querySelector("#mediaTable tbody");
  tbody.innerHTML = "";

  media.forEach((m) => {
    const row = document.createElement("tr");

    // ID
    const tdId = document.createElement("td");
    tdId.textContent = m.id;
    row.appendChild(tdId);

    // Preview
    const tdThumb = document.createElement("td");
    tdThumb.className = "thumb-col";

    const wrapper = document.createElement("div");
    wrapper.className = "thumb-wrapper";

    if (m.mediaType === "IMAGE") {
      const img = document.createElement("img");
      img.src = m.url;
      img.alt = m.filename || "Media";
      wrapper.appendChild(img);
    } else if (m.mediaType === "VIDEO") {
      const span = document.createElement("span");
      span.textContent = "VIDEO";
      span.style.fontSize = "10px";
      span.style.color = "var(--text-muted)";
      wrapper.appendChild(span);
    } else {
      const span = document.createElement("span");
      span.textContent = "—";
      span.style.fontSize = "10px";
      span.style.color = "var(--text-muted)";
      wrapper.appendChild(span);
    }

    tdThumb.appendChild(wrapper);
    row.appendChild(tdThumb);

    // Bestandsnaam
    const tdFilename = document.createElement("td");
    tdFilename.textContent = m.filename;
    row.appendChild(tdFilename);

    // Type
    const tdType = document.createElement("td");
    tdType.textContent = m.mediaType;
    row.appendChild(tdType);

    // MIME
    const tdMime = document.createElement("td");
    tdMime.textContent = m.mimeType;
    row.appendChild(tdMime);

    // URL
    const tdUrl = document.createElement("td");
    tdUrl.className = "url-cell";
    const a = document.createElement("a");
    a.href = m.url;
    a.target = "_blank";
    a.textContent = m.url;
    a.style.color = "var(--accent)";
    a.style.textDecoration = "none";
    tdUrl.appendChild(a);
    row.appendChild(tdUrl);

    // Acties
    const tdActions = document.createElement("td");
    const btn = document.createElement("button");
    btn.className = "danger";
    btn.textContent = "Verwijderen";
    btn.onclick = () => deleteMedia(m.id);
    tdActions.appendChild(btn);
    row.appendChild(tdActions);

    tbody.appendChild(row);
  });
}

/**
 * Upload van media.
 * - Kan worden aangeroepen met een FileList / array (drag & drop)
 * - Of zonder argument (pakt bestanden uit de file input)
 */
async function uploadMedia(fileList) {
  const tenantSelect = document.getElementById("tenantSelect");
  const fileInput = document.getElementById("uploadFile");

  const tenantId = tenantSelect.value;

  if (!tenantId) {
    alert("Selecteer eerst een tenant.");
    return;
  }

  // Verzamel bestanden uit argument of uit de input
  const files = [];
  if (fileList && fileList.length) {
    for (let i = 0; i < fileList.length; i++) {
      files.push(fileList[i]);
    }
  } else if (fileInput.files && fileInput.files.length) {
    for (let i = 0; i < fileInput.files.length; i++) {
      files.push(fileInput.files[i]);
    }
  }

  if (files.length === 0) {
    alert("Geen bestanden geselecteerd.");
    return;
  }

  const formData = new FormData();
  formData.append("tenantId", tenantId);
  files.forEach((file) => {
    formData.append("files", file);
  });

  const resp = await fetch("/api/admin/media/upload", {
    method: "POST",
    body: formData,
  });

  if (!resp.ok) {
    const text = await resp.text().catch(() => "");
    console.error("Fout bij upload:", resp.status, text);
    alert("Fout bij uploaden van media. Zie console voor details.");
    return;
  }

  await loadMedia();

  // input resetten
  fileInput.value = "";
}

/**
 * Media via URL registreren
 */
async function createMedia() {
  const tenantId = document.getElementById("tenantSelect").value;
  const filename = document.getElementById("filename").value.trim();
  const url = document.getElementById("url").value.trim();
  const mimeType = document.getElementById("mimeType").value.trim();
  const mediaType = document.getElementById("mediaType").value;

  if (!tenantId) {
    alert("Selecteer een tenant.");
    return;
  }
  if (!filename || !url || !mimeType || !mediaType) {
    alert("Alle velden zijn verplicht.");
    return;
  }

  const resp = await fetch(`/api/admin/tenants/${tenantId}/media`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ filename, url, mimeType, mediaType }),
  });

  if (!resp.ok) {
    const text = await resp.text().catch(() => "");
    console.error("Fout bij aanmaken media:", resp.status, text);
    alert("Fout bij opslaan van media. Zie console voor details.");
    return;
  }

  document.getElementById("filename").value = "";
  document.getElementById("url").value = "";
  document.getElementById("mimeType").value = "";

  loadMedia();
}

async function deleteMedia(id) {
  if (!confirm("Media verwijderen? Dit verwijdert ook koppelingen in playlists.")) return;

  const resp = await fetch(`/api/admin/media/${id}`, {
    method: "DELETE",
  });

  if (!resp.ok) {
    const text = await resp.text().catch(() => "");
    console.error("Fout bij verwijderen media:", resp.status, text);
    alert("Fout bij verwijderen van media. Zie console voor details.");
    return;
  }

  loadMedia();
}

/**
 * Drag & drop + klikgedrag initialiseren
 */
function initUploadUI() {
  const dropZone = document.getElementById("dropZone");
  const fileInput = document.getElementById("uploadFile");

  if (!dropZone || !fileInput) return;

  // Klik op de zone opent de bestandskiezer
  dropZone.addEventListener("click", () => {
    fileInput.click();
  });

  // Bestanden gekozen via de file input
  fileInput.addEventListener("change", () => {
    if (fileInput.files && fileInput.files.length > 0) {
      uploadMedia(fileInput.files); // meerdere bestanden
    }
  });

  // Drag events
  ["dragenter", "dragover"].forEach((eventName) => {
    dropZone.addEventListener(eventName, (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.add("dragover");
    });
  });

  ["dragleave", "dragend", "drop"].forEach((eventName) => {
    dropZone.addEventListener(eventName, (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (eventName !== "drop") {
        dropZone.classList.remove("dragover");
      }
    });
  });

  dropZone.addEventListener("drop", (e) => {
    dropZone.classList.remove("dragover");
    const dt = e.dataTransfer;
    if (!dt || !dt.files || dt.files.length === 0) return;

    // alle bestanden in één keer uploaden
    uploadMedia(dt.files);
  });
}

// Init
loadTenants();
initUploadUI();
</script>

</body>
</html>
